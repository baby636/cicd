# -*- mode: ruby -*-
# # vi: set ft=ruby :

Vagrant.require_version ">= 2.2.9"

Vagrant.configure(2) do |config|
  #
  # Common configuration
  #
  config.vm.box = "ubuntu/focal64"
  config.vm.synced_folder '.', '/vagrant', disabled: true

  #
  # GitLab
  #
  config.vm.define 'gitlab' do |gitlab|
    gitlab.vm.network 'private_network', ip: ENV['local_gitlab_ip']

    gitlab.vm.provider :virtualbox do |vbox|
      vbox.gui    = false
      vbox.cpus   = 2
      vbox.memory = 4096

      # BUG: https://github.com/hashicorp/vagrant/issues/11777
      vbox.customize ["modifyvm", :id, "--uart1", "0x3F8", "4"]
      vbox.customize ["modifyvm", :id, "--uartmode1", "file", File::NULL]
    end
  end

  #
  # GitLab Runner
  #
  config.vm.define 'runner' do |runner|
    runner.vm.network 'private_network', ip: ENV['local_runner_ip']

    runner.vm.provider :virtualbox do |vbox|
      vbox.gui    = false
      vbox.cpus   = 2
      vbox.memory = 4096

      # BUG: https://github.com/hashicorp/vagrant/issues/11777
      vbox.customize ["modifyvm", :id, "--uart1", "0x3F8", "4"]
      vbox.customize ["modifyvm", :id, "--uartmode1", "file", File::NULL]
    end
  end
end
